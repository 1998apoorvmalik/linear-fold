// set the active tab
let pageUrl = window.location.href;
if (pageUrl.includes("partition")) {
  document.getElementById("partition").classList.add("active");
} else if (pageUrl.includes("linearsankoff")) {
  document.getElementById("linearsankoff").classList.add("active");
} else if (pageUrl.includes("sampling")) {
  document.getElementById("sampling").classList.add("active");
} else if (pageUrl.includes("linearturbofold")) {
  document.getElementById("linearturbofold").classList.add("active");
} else {
  document.getElementById("linearfold").classList.add("active");
}

function fileUploadListener() {
  const fileUpload = document.getElementById("SeqFile");
  const fileContents = document.getElementById("seqInput");

  if (fileUpload) {
    fileUpload.addEventListener("change", function () {
      const file = fileUpload.files[0];
      const reader = new FileReader();
      reader.addEventListener("load", function () {
        if (fileContents) {
          fileContents.value = reader.result;
        }
      });
      reader.readAsText(file);
    });
  }
}

function validateInput(id, min, max) {
  let input = document.getElementById(id);
  let value = input.value;

  if (value < min || value > max || isNaN(value)) {
    input.classList.add("is-invalid");
    input.classList.remove("is-valid");
    return false;
  } else {
    input.classList.remove("is-invalid");
    input.classList.add("is-valid");
    // remove red border
    input.style.border = "1px solid #ced4da";
    return true;
  }
}

function makeFornaUrl(baseUrl, sequence, structure) {
  let url = baseUrl + "?id=fasta&file=%3Eheader%5Cn" + sequence + "%5Cn" + structure;
  return url;
}

// ------------------------------------------------------ Linear Sankoff Specific Interface ------------------------------------------------------------
const LS_SAMPLES = [
  ">tdbD00005111.dotbracket\nGCCGUGAUAGCUCAGUUGGGAGAGCGUCAGACUGAAGAUCUGAAGGUCCCUGGUUCGAUCCCUGGUCACGGCA\n>tdbD00001770.dotbracket\nGUCAGGAUGGCCGAGUGGUCUAAGGCGCUGCGUUCAGGUCGCAGUCUACUCUGUAGGCGUGGGUUCGAAUCCCACUUCUGACA",
  ">seq1\nGUUCCCGUCUAUUGCAAGACACCAGUUACUGAAUGUGUUCUGUUGGAAAGAGAACAUAUUGAAGUAAUAAUGAACUGCAAAC\n>seq2\nGCUGUCUGGCGCGGGCGGGAGUCGUCCUUGGUGGCCUUCCGUAGGGGAGGCUUCCGGGUCGUUGAAUGCGGCGUACCGCUUC",
  ">seq1\nGUUCCCGUCUAUUGCAAGACACCAGU\n>seq2\nGCUGUCUGGCGCGGGCGGGAGUCGU",
  ">B00650 118\nGCCUGGUGGCUAUGGCGAGGAGGCCUAACCCGAUCCCAUCCCGAACUCGGCCGUUAAACUCCUCAGUGCCGAUGGUACUAUGUCUUAAGACCUGGGAGAGUAGGUCGUCGCCAGGCCU\n>B01704 115\nCCUGGCGGCGAUAGUGCGGUGGACCCACCUGAGACCAUACCGAACUCAGAAGUGAAACGCUGUAAUGCCGAUGGUAGUGUGGGGUUUCCCCAUGUGAGAGUAGGGCACCGCCGGG",
];

if (pageUrl.includes("linearsankoff")) {
  document.getElementById("footer").classList.add("disabled");
}

// check if page containes an id 'result'
if (document.getElementById("result-page")) {
  // disable id cluster map
  document.getElementById("footer").classList.add("disabled");
}

function loadLinearSankoffSample(index) {
  if (index < LS_SAMPLES.length) {
    document.getElementById("seqInput").value = LS_SAMPLES[index];
  } else {
    document.getElementById("seqInput").value = index;
  }
}
// -----------------------------------------------------------------------------------------------------------------------------------------------------

// .
// .
// .
// .
// .

// --------------------------------------------********** WARNING ********ÃŸ**-----------------------------------------------
// --------------------------------------------* TOUCH AT DEVELOPER'S RISK *-----------------------------------------------
// --------------------------------------------*--- Might Break Things ----*-----------------------------------------------
// --------------------------------------------******* Kaibo's code ********----------------------------------------------------

if ($("#seqInput").text() == "") {
  $("#seqInput").css("color", "lightgrey");
  $("#submit").prop("disabled", true);
}

function update_textarea(e) {
  e.style.color = "black";
  $("#submit").prop("disabled", false);
}

$("#constrBox").change(function () {
  var lst = $("#seqInput").val().split("\n");
  //var initial_seq1 = 'GGUUAAGCGACUAAGCGUACACGGUGGAUGCCCUGGCAGUCAGAGGCGAUGAAGG';
  var initial_seq1 = "GCUCUGUUGGUGUAGUCCGGCCAAUCAUAUCACCCUCU";
  var initial_seq2 = "AACUCCGCCAGGCCUGGAAGGGAGCAACGGUAGUGACACUCUCUGUGUGCGUAGGUUGCCUAGCUACCAUUU";
  var initial_con2 = "??(????????????(????????)???(??????(???????)?)???????????)??.???????????";
  if (this.checked) {
    seqL = lst[1].length;
    if (lst[1] == initial_seq1) {
      $("#seqInput").val(">name_with_constraints\n" + initial_seq2 + "\n" + initial_con2);
    } else {
      $("#seqInput").val(lst[0] + "\n" + lst[1] + "\n" + "?".repeat(seqL));
      console.log("adding ? * " + seqL + " as constraints");
    }
    $("#constrant_intro").show();
    $("#zukerBox").prop("checked", false);
    $("#zukerBox").prop("disabled", true);
    $("#zukerDeltaLine").hide();
  } else {
    if (lst[1] == initial_seq2) {
      $("#seqInput").val(">name\n" + initial_seq1);
    } else {
      $("#seqInput").val(lst[0] + "\n" + lst[1]);
    }
    $("#constrant_intro").hide();
    $("#zukerBox").prop("disabled", false);
  }
});

$("#zukerBox").change(function () {
  if (this.checked) {
    $("#zukerDeltaLine").show();
  } else {
    $("#zukerDeltaLine").hide();
  }
});

function sampleInput(idx) {
  var seqs = [
    ">tRNA_tdbR00000566-Homo_sapiens-9606-Tyr-9PA \nCCUUCGAUAGCUCAGCUGGUAGAGCGGAGGACUGUAGAUCCUUAGGUCGCUGGUUCGAUUCCGGCUCGAAGGACCA",
    //'>tRNA_tdbR00000042-Haloferax_volcanii-2246-Glu-MUC.ct \nGCUCUGUUGGUGUAGUCCGGCCAAUCAUAUCACCCUCUCACGGUGAUGACCAGGGUUCGAAUCCCUGACGGAGCACCA',
    ">SRP_Oryz.sati._AC079888 \nGCCGAGCCAGGUAGCGUUGGCUUGUCACCCGAGCGGGGGCAAUAAGGUGGUGUUGGAUGCCUGGUCGUUUGCGCUUGGGGUCUGCGCCUGUGGUUUGCACUAUGCGGCCCGCCCGUUCCAAGUUGCGUAGCGUGUGUGGGGCGCCUGGGCGAAGGCUCGAGCGUCCCUGCACCUAGAGUGGCGGGUAUUGCGUGAGGCUGGUUUCACAGAGCAGCGAGUACCGCCCGCUUCCAACGGUGGAAGGAUAACGGGCCGCUGCAGCCCUGGCCCGCUUCCGGCCCAAGUGCCUUCCAUGGCAGACCACCACCUUU",
    ">16S rRNA_A.pyrophilus \nUUCCCUGAAGAGUUUGAUCCUGGCUCAGCGCGAACGCUGGCGGCGUGCCUAACACAUGCAAGUCGUGCGCAGGCUCGCUCCCUCUGGGAGCGGGUGCUGAGCGGCAAACGGGUGAGUAACACGUGGGUAACCUACCCCCAGGAGGGGGAUAACCCCGGGAAACCGGGGCUAAUACCCCAUAAAGCCGCCCGCCACUAAGGCGAGGCGGCCAAAGGGGGCCUCUGGGCUCUGCCCAAGCUCCCGCCUGGGGAUGGGCCCGCGGCCCAUCAGGUAGUUGGUGGGGUAACGGCCCACCAAGCCUAUGACGGGUAGCCGGCCUGAGAGGGUGGCCGGCCACAGCGGGACUGAGACACGGCCCGCACCCCUACGGGGGGCAGCAGUGGGGAAUCGUGGGCAAUGGGCGAAAGCCUGACCCCGCGACGCCGCGUGGGGGAAGAAGCCCUGCGGGGUGUAAACCCCUGUCGGGGGGGACGAAGGGACUGUGGGUUAAUAGCCCACAGUCUUGACGGUACCCCCAGAGGAAGGGACGGCUAACUACGUGCCAGCAGCCGCGGUAAUACGUAGGUCCCGAGCGUUGCGCGAAGUCACUGGGCGUAAAGCGUCCGCAGCCGGUCGGGUAAGCGGGAUGUCAAAGCCCACGGCUCAACCGUGGAAUGGCAUCCCGAACUGCCCGACUUGAGGCACGCCCGGGCAGGCGGAAUUCCCGGGGUAGCGGUGAAAUGCGUAGAUCUCGGGAGGAACACCGAAGGGGAAGCCAGCCUGCUGGGGCUGUCCUGACGGUCAGGGACGAAAGCCGGGGGAGCGAACCGGAUUAGAUACCCGGGUAGUCCCGGCCGUAAACCAUGGGCGCUAGGGCUUGUCCCUUUGGGGCAGGCUCGCAGCUAACGCGUUAAGCGCCCCGCCUGGGGAGUACGGGCGCAAGCCUGAAACUCAAAGGAAUUGGCGGGGGCCCGCACAACCGGUGGAGCGUCUGGUUCAAUUCGAUGCUAACCGAAGAACCUUACCCGGGCUUGACAUGCCGGGGAGACUCCGCGAAAGCGGAGUUGUGGAAGUCUCUGACUUCCCCCCGGCACAGGUGGUGCAUGGCCGUCGUCAGCUCGUGUCGUGAGAUGUUGGGUUAAGUCCCGCAACGAGCGCAACCCCUGCCCCUAGUUGCUACCCCGAGAGGGGAGCACUCUAGGGGGACCGCCGGCGAUAAGCCGGAGGAAGGGGGGGAUGACGUCAGGUCAGUAUGCCCUUUAUGCCCGGGGCCACACAGGCGCUACAGUGGCCGGGACAAUGGGAAGCGACCCCGCAAGGGGGAGCUAAUCCCAGAAACCCGGUCAUGGUGCGGAUUGGGGGCUGAAACUCGCCCCCAUGAAGCCGGAAUCGGUAGUAACGGGGUAUCAGCGAUGUCCCCGUGAAUACGUUCUCGGGCCUUGCACACACCGCCCGUCACGCCACGGAAGUCGGUCCGGCCGGAAGUCCCCGAGCUAACCGGCCCUUUUUGGGCCGGGGGCAGGGGCCGAUGGCCGGGCCGGCGACUGGGGCGAAGUCGUAACAAGGUAGCCGUAGGGGAACCUGC",
    ">23S rRNA_T.thermophilus \nGGUCAAGAUGGUAAGGGCCCACGGUGGAUGCCUCGGCACCCGAGCCGAUGAAGGACGUGGCUACCUGCGAUAAGCCAGGGGGAGCCGGUAGCGGGCGUGGAUCCCUGGAUGUCCGAAUGGGGGAACCCGGCCGGCGGGAACGCCGGUCACCGCGCUUUUGCGCGGGGGGAACCUGGGGAACUGAAACAUCUCAGUACCCAGAGGAGAGGAAAGAGAAAUCGACUCCCUGAGUAGCGGCGAGCGAAAGGGGACCAGCCUAAACCGUCCGGCUUGUCCGGGCGGGGUCGUGGGGCCCUCGGACACCGAAUCCCCAGCCUAGCCGAAGCUGUUGGGAAGCAGCGCCAGAGAGGGUGAAAGCCCCGUAGGCGAAAGGUGGGGGGAUAGGUGAGGGUACCCGAGUACCCCGUGGUUCGUGGAGCCAUGGGGGAAUCUGGGCGGACCACCGGCCUAAGGCUAAGUACUCCGGGUGACCGAUAGCGCACCAGUACCGUGAGGGAAAGGUGAAAAGAACCCCGGGAGGGAGUGAAAUAGAGCCUGAAACCGUGGGCUUACAAGCAGUCACGGCCCCGCAAGGGGUUGUGGCGUGCCUAUUGAAGCAUGAGCCGGCGACUCACGGUCGUGGGCGAGCUUAAGCCGUUGAGGCGGAGGCGUAGGGAAACCGAGUCCGAACAGGGCGCAAGCGGGCCGCACGCGGCCCGCAAAGUCCGCGGCCGUGGACCCGAAACCGGGCGAGCUAGCCCUGGCCAGGGUGAAGCUGGGGUGAGACCCAGUGGAGGCCCGAACCGGUGGGGGAUGCAAACCCCUCGGAUGAGCUGGGGCUAGGAGUGAAAAGCUAACCGAGCCCGGAGAUAGCUGGUUCUCCCCGAAAUGACUUUAGGGUCAGCCUCAGGCGCUGACUGGGGCCUGUAGAGCACUGAUAGGGCUAGGGGGCCCACCAGCCUACCAAACCCUGUCAAACUCCGAAGGGUCCCAGGUGGAGCCUGGGAGUGAGGGCGCGAGCGAUAACGUCCGCGUCCGAGCGCGGGAACAACCGAGACCGCCAGCUAAGGCCCCCAAGUCUGGGCUAAGUGGUAAAGGAUGUGGCGCCGCGAAGACAGCCAGGAGGUUGGCUUAGAAGCAGCCAUCCUUUAAAGAGUGCGUAAUAGCUCACUGGUCGAGUGGCGCCGCGCCGAAAAUGAUGCGGGGCUUAAGCCCAGCGCCGAAGCUGCGGGUCUGGGGGAUGACCCCAGGCGGUAGGGGAGCGUUCCCGAUGCCGAUGAAGGCCGACCCGCGAGGCGGCUGGAGGUAAGGGAAGUGCGAAUGCCGGCAUGAGUAACGAUAAAGAGGGUGAGAAUCCCUCUCGCCGUAAGCCCAAGGGUUCCUACGCAAUGGUCGUCAGCGUAGGGUUAGGCGGGACCUAAGGUGAAGCCGAAAGGCGUAGCCGAAGGGCAGCCGGUUAAUAUUCCGGCCCUUCCCGCAGGUGCGAUGGGGGGACGCUCUAGGCUAGGGGGACCGGAGCCAUGGACGAGCCCGGCCAGAAGCGCAGGGUGGGAGGUAGGCAAAUCCGCCUCCCAACAAGCUCUGCGUGGUGGGGAAGCCCGUACGGGUGACAACCCCCCGAAGCCAGGGAGCCAAGAAAAGCCUCUAAGCACAACCUGCGGGAACCCGUACCGCAAACCGACACAGGUGGGCGGGUGCAAGAGCACUCAGGCGCGCGGGAGAACCCUCGCCAAGGAACUCUGCAAGUUGGCCCCGUAACUUCGGGAGAAGGGGUGCUCCCUGGGGUGAUGAGCCCCGGGGAGCCGCAGUGAACAGGCUCUGGCGACUGUUUACCAAAAACACAGCUCUCUGCGAACUCGUAAGAGGAGGUAUAGGGAGCGACGCUUGCCCGGUGCCGGAAGGUCAAGGGGAGGGGUGCAAGCCCCGAACCGAAGCCCCGGUGAACGGCGGCCGUAACUAUAACGGUCCUAAGGUAGCGAAAUUCCUUGUCGGGUAAGUUCCGACCUGCACGAAAAGCGUAACGACCGGAGCGCUGUCUCGGCGAGGGACCCGGUGAAAUUGAACUGGCCGUGAAGAUGCGGCCUACCCGUGGCAGGACGAAAAGACCCCGUGGAGCUUUACUGCAGCCUGGUGUUGGCUCUUGGUCGCGCCUGCGUAGGAUAGGUGGGAGCCUGUGAACCCCCGCCUCCGGGUGGGGGGGAGGCGCCGGUGAAAUACCACCCUGGCGCGGCUGGGGGCCUAACCCUCGGAUGGGGGGACAGCGCUUGGCGGGCAGUUUGACUGGGGCGGUCGCCUCCUAAAAGGUAACGGAGGCGCCCAAAGGUCCCCUCAGGCGGGACGGAAAUCCGCCGGAGAGCGCAAGGGUAGAAGGGGGCCUGACUGCGAGGCCUGCAAGCCGAGCAGGGGCGAAAGCCGGGCCUAGUGAACCGGUGGUCCCGUGUGGAAGGGCCAUCGAUCAACGGAUAAAAGUUACCCCGGGGAUAACAGGCUGAUCUCCCCCGAGCGUCCACAGCGGCGGGGAGGUUUGGCACCUCGAUGUCGGCUCGUCGCAUCCUGGGGCUGAAGAAGGUCCCAAGGGUUGGGCUGUUCGCCCAUUAAAGCGGCACGCGAGCUGGGUUCAGAACGUCGUGAGACAGUUCGGUCUCUAUCCGCCACGGGCGCAGGAGGCUUGAGGGGGGCUCUUCCUAGUACGAGAGGACCGGAAGGGACGCACCUCUGGUUUCCCAGCUGUCCCUCCAGGGGCAUAAGCUGGGUAGCCAUGUGCGGAAGGGAUAACCGCUGAAAGCAUCUAAGCGGGAAGCCCGCCCCAAGAUGAGGCCUCCCACGGCGUCAAGCCGGUAAGGACCCGGGAAGACCACCCGGUGGAUGGGCCGGGGGUGUAAGCGCCGCGAGGCGUUGAGCCGACCGGUCCCAAUCGUCCGAGGUCUUGACCCCUC",
  ];

  document.getElementById("seqInput").value = seqs[idx];
  document.getElementById("beamSize").value = "100";
  document.getElementById("constrBox").checked = false;
  $("#constrant_intro").hide();
}

function sampleInputs(idx) {
  var seqs = [
    ">Babe.bige._GSP-5866.seq \nACCCGGCUUUUGCUGUAACUCUUCUGAGGGGUGCUGGCUUGAACCCAGUGGGCUGUCAUGCUGGCGCGUCCUUGCGCUGGGCUGUCUGGCGCGGGCGGGAGUCGUCCUUGGUGGCCUUCCGUAGGGGAGGCUUCCGGGUCGUUGAAUGCGGCGUACCGCUUCAGGCUGGCAACAGAGCAGAGAUAAGCUUCAGCUUCCGCUACGCGGCAGACCGCAGCCCGCGCUGCUCGCAGUCCAUCAUCGUCAGGCCCCCCACCGGUGAACUUGCCCGCUAUUUUUU \n>Enta.hist._AF487684.seq \nGAUCCUAUCAUAUUUAUCAACGUUUGAGACUACCUCAUACCAUAUCUUCGUACUUCAUUACUAGAUAUACGUAGGUAGAUUUAGUGCGGAAGUAACGAACAGGGUACUGCGUGAGGCCGGUUACGGAGCAACGAAAACCUGUCUACGAUGAUAGACCUGGGUUGAUAUGGAUGUCAAGUUAAUACCUAUGCUAGUAUUGGAACUAAUUUU \n>Leis.infa._AM502223.seq \nGCCGGAGCUCAGCUCUGUAACCGUCGGGGGCUAAUCAGGCUUAGCGGGGAGGACGUGGACCAGCGAGGGUGACGCGCUGCGUUGACGUGGUGCUCUGCUUGGCUGUGUGUCGGUGUGACCCGCACCCCUGCAGAGGGGUGGCGCGGGCCCGCCGUUGAAGCGAGGGAACCGGGUCAGGCCGGAAACGGAGCAGCCCACCCCGCGCACGUCCGCCGUUGCAGAAUCACACCGCGGAGCAUGUCCGCACUUGAGCCCCACGCCUCGUCGCAAAGCCUUUUU \n>Tetr.ther._X56981.seq \nGCCAGGGUAGCAAUACCUGUGUCUAUAUGUGGCAUAAACAAUGUAGGUUGUGAUAGAUAGGAUAUGAGAGUUUGAUGAGACAGUUUGCUAAGAGUGUGCCCGCUCCAAACAAUGAGUUGCUAUGGUGGUAACCUAGUAAUAGGACUCCACCAGGGCAUUAAAGAGCUAAGGAAACGCCUCAGGCUGGCAACAGAACAGGGAAAACUUGCCGCUUGUUGUGGUGGAAGGAUAACAUACUCAUUAACUGUCAAACUAAUCGGUUCUACUAUCAAAGCCAGACAUU \n>Tryp.bruc._AF047723.seq \nAGCCGGAGCGCAUUGCUCUGUAACCUUCGGGGGCUGAUCCCGCUUAGCGGGGACGUCUUGGACAAGCGGGGGUUCUGUUGCGUUGACUUGGUGUUCUGCUUGGUUGCGUGUCGGUGUUGAGGUCGCCACUGUAGAGAGGCGUUCUCGCGCCGUUAAAGUGGGGGGAACGGGUCAGGCCGGUGACGGAGCAGCCCACCUUGCGCACGUUCCCGUUGCAGAAGCACACCGAGGAGCAUCUCAGGACUUUGCGCCCCAAGUGUCGUCGCGAGGCGG",
  ];

  document.getElementById("seqInput").value = seqs[idx];
  $("#seqInput").css("color", "black");
  $("#submit").prop("disabled", false);
  // document.getElementById('beamSize').value = '100';
  //document.getElementById("constrBox").checked = false;
}
function loading() {
  console.log("loading gif");
  document.getElementById("loadingIMG").style = "display:block";
}

window.onload = function (e) {
  $("#jobID").val(Date.now().toString(36) + Math.random().toString(36).substring(7));
  // console.log($('#jobID').val());
};
