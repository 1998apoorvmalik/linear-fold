<!DOCTYPE html>

<html>
  <head>
    <title>LinearFold Web Server (beta)</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"
    />
  </head>
  <!-- Force The Browser To Reload Cached .JS, .CSS Files To Reflect The Latest Changes To Those     Files -->
  <script type="text/javascript" language="javascript">
    var versionUpdate = new Date().getTime();
    var csslink = document.createElement("link");
    csslink.rel = "stylesheet";
    csslink.type = "text/css";
    csslink.href = "/css/interface.css?v=" + versionUpdate;
    document.head.appendChild(csslink);
  </script>

  <body>
    <div id="pageTitle">
      LinearSankoff Web Server (beta)
      <div class="nav-right">
        <a href="{{ url_for('my_form_old') }}">LinearFold</a> &nbsp&nbsp&nbsp
        <a href="{{ url_for('my_form_LP') }}">LinearPartition</a>
        &nbsp&nbsp&nbsp
        <a href="{{ url_for('my_form_LS_v') }}">LinearSampling</a>
        &nbsp&nbsp&nbsp<a href="{{ url_for('my_form_LTF') }}"
          >LinearTurboFold</a
        >
        &nbsp&nbsp&nbsp<a href="{{ url_for('my_form_LS') }}" class="nav-act"
          >LinearSankoff</a
        >
      </div>
    </div>

    <br />
    <img
      src="data:image/png;base64, {{ data['plot'] }}"
      style="display: block; margin-left: auto; margin-right: auto; width: 75%"
    />

    <br />

    <table width="80%">
      <tr>
        <td>
          <div class="res" style="font-family: monospace; letter-spacing: 1pt">
            <h2 style="color: #3bbee2">
              Result:
              <button onclick="copyOutput('result')">Copy to Clipboard</button>
            </h2>
            {% for line in data["alignment_result"] %}
            <p id="result" style="margin: 0px; padding: 0px">{{line}}</p>
            {% endfor %}
          </div>
        </td>
        <td>
          <p>
            Sequence 1 Folding Score: {{data["sequence 1 folding score"]}}
            kcal/mol
          </p>
          <p>
            Sequence 2 Folding Score: {{data["sequence 2 folding score"]}}
            kcal/mol
          </p>
          <p>Probability of Alignment Path: {{data["probability"]}}</p>
          <p>Time: {{data["time"]}} seconds</p>
        </td>
      </tr>
    </table>

    <br />
    <button
      style="font-size: large; background-color: #3bbee2; color: white"
      onclick="downloadResult()"
    >
      Download Results
    </button>

    <script src="/js/jquery.min.js"></script>

    <!-- Force The Browser To Reload Cached .JS, .CSS Files To Reflect The Latest Changes To Those Files -->
    <script type="text/javascript" language="javascript">
      var versionUpdate = new Date().getTime();
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "/js/interface.js?v=" + versionUpdate;
      document.body.appendChild(script);

      function getOutput(id) {
        const elements = document.querySelectorAll("#" + id);
        var text = "";
        for (var i = 0; i < elements.length; i++) {
          text += elements[i].innerHTML;
          // add a new line if it is not the last element
          if (i != elements.length - 1) text += "\n";
        }
        return text;
      }

      function copyOutput(id) {
        // navigator.clipboard.writeText(document.getElementById(id).innerHTML);
        navigator.clipboard.writeText(getOutput(id));
      }

      function downloadResult() {
        const result = {
          "Alignment 1": "{{ data['alignment 1'] }}",
          "Alignment 2": "{{ data['alignment 2'] }}",
          "Structure 1": "{{ data['structure 1'] }}",
          "Structure 2": "{{ data['structure 2'] }}",
          "Alignment Result": getOutput("result"),
          "Sequence 1 Folding Score":
            "{{ data['sequence 1 folding score'] }} kcal/mol",
          "Sequence 2 Folding Score":
            "{{ data['sequence 2 folding score'] }} kcal/mol",
          "Probability of Alignment Path": "{{ data['probability'] }}",
          Time: "{{ data['time'] }} seconds",
        };

        const data = JSON.stringify(result, null, 2);
        const blob = new Blob([data], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.download = "result.txt";
        a.href = url;
        a.click();
      }
    </script>
  </body>
</html>
